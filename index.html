<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundari Samaj</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="data.js"></script>
    <style>
        :root { 
            --primary: #1b3a2b; 
            --accent: #c5a059; 
            --bg-color: #f9f9f9; 
            --text-dark: #2c2c2c; 
            
            /* --- MX PLAYER STYLE SETTINGS --- */
            --plyr-color-main: #c5a059; 
            --plyr-video-control-color: #ffffff; 
            --plyr-control-radius: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* --- SCROLL FREEZE FIX --- */
        body.no-scroll {
            overflow: hidden !important;
            height: 100vh;
            touch-action: none; 
        }

        body { background-color: var(--bg-color); color: var(--text-dark); font-family: 'Poppins', sans-serif; overflow-x: hidden; padding-top: 70px; display: flex; flex-direction: column; min-height: 100vh; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        /* --- VIDEO PLAYER STYLING --- */
        .plyr {
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
            margin-bottom: 0; 
        }
        .plyr__controls {
            background: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.7)) !important;
            padding-bottom: 20px !important;
        }
        .plyr--video .plyr__control:hover {
            background: var(--accent) !important;
        }

        nav { 
            background: rgba(27, 58, 43, 0.95); padding: 0 5%; display: flex; align-items: center; justify-content: space-between; 
            position: fixed; top: 0; width: 100%; z-index: 1000; height: 75px; color: white; gap: 15px;
            transition: transform 0.4s ease-in-out; 
        }
        .nav-hidden { transform: translateY(-100%); }

        .logo { font-size: 1.4rem; font-weight: 600; color: white; text-decoration: none; white-space: nowrap; }
        .search-container { position: relative; flex-grow: 1; max-width: 400px; }
        .search-bar { width: 100%; padding: 10px 15px 10px 40px; border-radius: 30px; border: none; background: rgba(255,255,255,0.15); color: white; outline: none; }
        .search-results { position: absolute; top: 110%; left: 0; width: 100%; background: white; color: var(--text-dark); border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); display: none; max-height: 300px; overflow-y: auto; z-index: 2000; }
        .result-item { padding: 12px 15px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; justify-content: space-between; }
        .menu-btn { font-size: 1.8rem; cursor: pointer; display: block; z-index: 1001; }
        
        .desktop-menu { display: none; align-items: center; gap: 25px; }
        .desktop-menu a { color: rgba(255,255,255,0.9); text-decoration: none; font-weight: 500; }
        .desktop-login-btn { border: 1px solid var(--accent); padding: 8px 20px; border-radius: 20px; color: var(--accent) !important; }

        @media screen and (min-width: 900px) { .menu-btn { display: none; } .desktop-menu { display: flex; } }

        .hero-container { position: relative; height: 60vh; width: 100%; overflow: hidden; margin-top: -75px; background: #11241a; }
        .hero-slide { position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; transition: opacity 1s ease-in-out; }
        .hero-slide.active { opacity: 1; }
        .hero-slide img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .hero-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 10; width: 90%; color: white; }
        .hero-content h1 { font-size: 3.5rem; margin-bottom: 10px; }

        section { padding: 60px 5% 40px 5%; }
        .section-header { text-align: left; margin-bottom: 30px; }
        .section-title { color: var(--primary); font-size: 1.8rem; position: relative; }
        .section-title::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 40px; height: 3px; background: var(--accent); }

        .horizontal-scroll { 
            display: flex !important; 
            flex-direction: row !important; 
            flex-wrap: wrap;             
            justify-content: flex-start; 
            gap: 20px; 
            padding-bottom: 20px; 
        }
        
        .card { flex: 0 0 280px; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; margin-bottom: 20px; }
        .card img { width: 100%; height: 180px; object-fit: cover; background-color: #1b3a2b; }
        .card-body { padding: 15px; }

        .gallery-item { flex: 0 0 280px; height: 200px; border-radius: 12px; overflow: hidden; margin-bottom: 20px; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }

        .sidebar { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%) scale(0.9); 
            width: 85%; 
            max-width: 320px;
            background: white; 
            z-index: 3000; 
            padding: 30px; 
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); 
            opacity: 0;
            pointer-events: none; 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .sidebar.active { 
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: all;
        }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; z-index: 2500; backdrop-filter: blur(4px); }
        .overlay.active { display: block; }

        footer { background: #152e22; color: white; padding: 60px 5% 30px; text-align: center; border-top: 4px solid var(--accent); }
        .footer-content { max-width: 800px; margin: 0 auto; }
        .footer-content h2 { font-size: 2.2rem; color: var(--accent); margin-bottom: 15px; }
        .footer-content p { font-size: 1rem; line-height: 1.8; color: rgba(255,255,255,0.8); margin-bottom: 30px; }
        .footer-divider { height: 1px; background: rgba(255,255,255,0.1); margin-bottom: 20px; }
        .footer-bottom { font-size: 0.85rem; color: rgba(255,255,255,0.5); }
    </style>
</head>
<body>
    <nav id="mainNav">
        <a href="#" class="logo">Mundari Samaj</a>
        <div class="search-container">
            <i class="material-icons" style="position:absolute; left:12px; top:12px; color:rgba(255,255,255,0.6);">search</i>
            <input type="text" class="search-bar" id="searchInput" placeholder="Search..." onkeyup="doSearch()">
            <div class="search-results" id="searchResults"></div>
        </div>
        <div class="desktop-menu">
            <a href="#history">History</a><a href="#videos">Videos</a><a href="#gallery">Gallery</a>
            <span id="desktopUserText" style="color:white; font-size:0.8rem; border-bottom:1px solid #c5a059; display:none;"></span>
            <a href="login.html" id="desktopLoginLink" class="desktop-login-btn">Login</a>
        </div>
        <div class="menu-btn" onclick="toggleMenu()"><i class="material-icons">menu</i></div>
    </nav>
    <div class="overlay" onclick="toggleMenu()"></div>
    
    <div class="sidebar" id="sidebar">
        <h3 style="margin-bottom:20px;">Menu <span onclick="toggleMenu()" style="float:right;cursor:pointer"><i class="material-icons">close</i></span></h3>
        <div id="userDisplay" style="color:#1b3a2b; font-weight:bold; padding:15px 0; border-bottom: 2px solid var(--accent); margin-bottom:10px; display:none;"></div>
        <a href="#history" style="display:block; padding:15px 0; text-decoration:none; color:#333;" onclick="toggleMenu()">History</a>
        <a href="#videos" style="display:block; padding:15px 0; text-decoration:none; color:#333;" onclick="toggleMenu()">Videos</a>
        <a href="#gallery" style="display:block; padding:15px 0; text-decoration:none; color:#333;" onclick="toggleMenu()">Gallery</a>
        <a href="login.html" id="loginLink" style="color:#c5a059; font-weight:bold; display:block; margin-top:20px; text-decoration:none;">Login</a>
    </div>

    <div class="hero-container" id="heroSlider">
        <div class="hero-content">
            <h1 id="heroTitle">Mundari Samaj</h1>
            <p id="heroDesc" style="font-size:1.1rem; opacity:0.9;"></p>
        </div>
    </div>

    <section id="history">
        <div class="section-header"><h2 class="section-title">History</h2></div>
        <div class="horizontal-scroll" id="historyContainer"></div>
    </section>
    <section id="videos">
        <div class="section-header"><h2 class="section-title">Videos</h2></div>
        <div class="horizontal-scroll" id="videoContainer"></div>
    </section>
    <section id="gallery">
        <div class="section-header"><h2 class="section-title">Gallery</h2></div>
        <div class="horizontal-scroll" id="galleryContainer"></div>
    </section>

    <footer>
        <div class="footer-content">
            <h2>About Us</h2>
            <p>We are dedicated to the preservation and promotion of the Mundari language, heritage, and culture. Through this platform, we aim to share the rich traditional songs, history, and stories of our community with the world.</p>
            <div class="footer-divider"></div>
            <div class="footer-bottom">&copy; 2026 Mundari Samaj. All Rights Reserved.</div>
        </div>
    </footer>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js" defer></script>
    <script>
        const nav = document.getElementById('mainNav');
        window.addEventListener('scroll', () => {
            (window.pageYOffset > 100) ? nav.classList.add('nav-hidden') : nav.classList.remove('nav-hidden');
        });

        // --- KEY FIX: Priority is now Swapped ---
        function getDb(key) {
            // 1. First, check Local Storage (Admin Updates)
            const local = JSON.parse(localStorage.getItem(key));
            if (local && local.length > 0) return local;

            // 2. If no local data, check the Database file (Public View)
            if (typeof MUNDARI_DB !== 'undefined' && MUNDARI_DB[key]) return MUNDARI_DB[key];

            // 3. If nothing, return empty
            return [];
        }

        window.onload = function() {
            const user = JSON.parse(localStorage.getItem('mundari_user'));
            if(user) {
                document.getElementById('userDisplay').style.display = 'block';
                document.getElementById('desktopUserText').style.display = 'inline-block';
                let greeting = (user.type === 'admin') ? "Johar, Jay Mundari" : "Johar, " + user.name;
                document.getElementById('userDisplay').innerText = greeting;
                document.getElementById('desktopUserText').innerText = greeting;
            }

            // Hero Section
            let localHeroT = localStorage.getItem('mundari_hero_title');
            document.getElementById('heroTitle').innerText = localHeroT ? localHeroT : ((typeof MUNDARI_DB!=='undefined'?MUNDARI_DB['mundari_hero_title']:"Mundari Samaj"));
            
            let localHeroD = localStorage.getItem('mundari_hero_desc');
            document.getElementById('heroDesc').innerText = localHeroD ? localHeroD : ((typeof MUNDARI_DB!=='undefined'?MUNDARI_DB['mundari_hero_desc']:""));

            // Render History
            getDb('mundari_history_list').forEach(i => {
                document.getElementById('historyContainer').innerHTML += `<div class="card" onclick="window.location.href='article.html?id=${i.id}'"><img src="${i.thumb}" onerror="this.src='https://via.placeholder.com/300x200';"><div class="card-body"><h3>${i.title}</h3></div></div>`;
            });
            
            // Render Videos
            getDb('mundari_video_list').forEach(v => {
                let source = v.link.includes('youtu') 
                    ? `<div class="plyr__video-embed js-player"><iframe src="${v.link}" allowfullscreen allowtransparency allow="autoplay"></iframe></div>` 
                    : `<video controls class="js-player" style="width:100%"><source src="${v.link}"></video>`;
                
                document.getElementById('videoContainer').innerHTML += `
                    <div class="card" style="cursor:default; background:black;">
                        ${source}
                        <div class="card-body" style="background:white;"><h3>${v.title}</h3></div>
                    </div>`;
            });
            
            setTimeout(() => { 
                if(window.Plyr) {
                    const players = Array.from(document.querySelectorAll('.js-player')).map(p => new Plyr(p, {
                        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
                        hideControls: true,
                        tooltips: { controls: true, seek: true }
                    }));
                }
            }, 1000);

            // Render Gallery
            getDb('mundari_gallery_list').forEach(g => {
                document.getElementById('galleryContainer').innerHTML += `<div class="gallery-item"><img src="${g.url}" onerror="this.style.display='none'"></div>`;
            });

            // Render Hero Images
            const imgs = getDb('mundari_hero_images');
            if(imgs.length > 0) {
                const slider = document.getElementById('heroSlider');
                imgs.forEach((url, i) => { slider.innerHTML += `<div class="hero-slide ${i===0?'active':''}"><img src="${url}"></div>`; });
                let cur = 0; const slides = document.querySelectorAll('.hero-slide');
                if(slides.length > 1) setInterval(() => { slides[cur].classList.remove('active'); cur = (cur + 1) % slides.length; slides[cur].classList.add('active'); }, 5000);
            }
        };

        function toggleMenu() { 
            const sb = document.querySelector('.sidebar');
            const ov = document.querySelector('.overlay');
            const bd = document.body;
            
            sb.classList.toggle('active'); 
            ov.classList.toggle('active');
            
            if (sb.classList.contains('active')) {
                bd.classList.add('no-scroll');
                bd.style.overflow = "hidden";
            } else {
                bd.classList.remove('no-scroll');
                bd.style.overflow = "";
            }
        }

        function doSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const resultsBox = document.getElementById('searchResults');
            resultsBox.innerHTML = '';
            if(query.length < 2) { resultsBox.style.display = 'none'; return; }
            let hits = 0;
            getDb('mundari_history_list').forEach(h => {
                if(h.title.toLowerCase().includes(query)) {
                    resultsBox.innerHTML += `<div class="result-item" onclick="window.location.href='article.html?id=${h.id}'"><span>${h.title}</span><span style="font-size:0.7rem; color:#999;">History</span></div>`;
                    hits++;
                }
            });
            resultsBox.style.display = hits > 0 ? 'block' : 'none';
        }
    </script>
</body>
</html>